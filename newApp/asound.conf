# ALSA config for WM8960 full-duplex (simultaneous record + playback)
# Required for Voice Agent mode where mic and speaker run concurrently.
# Auto-synced to ~/.asoundrc on every boot by main.py.
#
# The WM8960 is a full-duplex codec but ALSA's hw: plugin only allows
# one open at a time. dmix/dsnoop each try to open hw: separately and
# fight over it. Solution: use asym to open hw: ONCE in full-duplex
# mode, then wrap with plug for format conversion.

# -- Full-duplex device: single hw: open for both directions --
pcm.duplex {
    type asym
    playback.pcm "plughw:wm8960soundcard"
    capture.pcm "plughw:wm8960soundcard"
}

# Named devices for our code to reference
pcm.speaker {
    type plug
    slave.pcm "plughw:wm8960soundcard"
}

pcm.mic {
    type plug
    slave.pcm "plughw:wm8960soundcard"
}

# Default uses the full-duplex device
pcm.!default {
    type asym
    playback.pcm "plughw:wm8960soundcard"
    capture.pcm "plughw:wm8960soundcard"
}

ctl.!default {
    type hw
    card wm8960soundcard
}

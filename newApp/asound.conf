# ALSA config for WM8960 full-duplex (simultaneous record + playback)
# Required for Voice Agent mode where mic and speaker run concurrently.
# Install: copy to ~/.asoundrc on the Pi

# -- Playback (shared output via dmix) --
pcm.speaker {
    type plug
    slave.pcm "dmixer"
}

pcm.dmixer {
    type dmix
    ipc_key 1024
    ipc_perm 0666
    slave {
        pcm "hw:wm8960soundcard"
        rate 16000
        channels 1
        format S32_LE
        period_size 800
        buffer_size 4800
    }
}

# -- Capture (shared input via dsnoop) --
pcm.mic {
    type plug
    slave.pcm "dsnooper"
}

pcm.dsnooper {
    type dsnoop
    ipc_key 2048
    ipc_perm 0666
    slave {
        pcm "hw:wm8960soundcard"
        rate 16000
        channels 1
        format S32_LE
        period_size 800
        buffer_size 4800
    }
}

# -- Full-duplex default using both --
pcm.!default {
    type asym
    playback.pcm "speaker"
    capture.pcm "mic"
}

ctl.!default {
    type hw
    card wm8960soundcard
}

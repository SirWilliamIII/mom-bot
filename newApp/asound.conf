# ALSA config for WM8960 full-duplex (simultaneous record + playback)
# Required for Voice Agent mode where mic and speaker run concurrently.
# Install: copy to ~/.asoundrc on the Pi
#
# WM8960 hardware facts:
#   - Playback: stereo (2ch), supports S16_LE/S32_LE, 8-96kHz
#   - Capture:  stereo (2ch), supports S16_LE/S32_LE, 8-96kHz
#   - Full-duplex: YES (can record and play simultaneously on hw: device)
#
# The trick: dmix/dsnoop slaves MUST use parameters the hardware accepts.
# We use S16_LE + 2 channels (hardware native) and let the plug layers
# convert our mono 16kHz streams to/from the hardware format.

# -- Playback (shared output via dmix) --
pcm.speaker {
    type plug
    slave.pcm "dmixer"
}

pcm.dmixer {
    type dmix
    ipc_key 1024
    ipc_perm 0666
    slave {
        pcm "hw:wm8960soundcard"
        rate 16000
        channels 2
        format S16_LE
        period_size 800
        buffer_size 4800
    }
}

# -- Capture (shared input via dsnoop) --
pcm.mic {
    type plug
    slave.pcm "dsnooper"
}

pcm.dsnooper {
    type dsnoop
    ipc_key 2048
    ipc_perm 0666
    slave {
        pcm "hw:wm8960soundcard"
        rate 16000
        channels 2
        format S16_LE
        period_size 800
        buffer_size 4800
    }
}

# -- Full-duplex default using both --
pcm.!default {
    type asym
    playback.pcm "speaker"
    capture.pcm "mic"
}

ctl.!default {
    type hw
    card wm8960soundcard
}
